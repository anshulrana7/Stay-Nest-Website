<% layout("/layouts/boilerplate") %>

<style>
.booking-card{
  transition: all 0.3s ease;
  cursor: pointer;
}
.card{
  border-radius: 15px;
}

.booking-card:hover{
  transform: scale(1.03);
  box-shadow: 0 10px 25px rgba(0,0,0,0.15);
}

.booking-img{
  height:200px;
  width:100%;
  object-fit:cover;
}

.status-badge{
  position:absolute;
  top:10px;
  right:10px;
  background:#28a745;
  color:white;
  padding:5px 10px;
  font-size:0.75rem;
  border-radius:20px;
}
/* ðŸ”½ Make card content compact */

.booking-card .card-body{
  font-size: 0.9rem;
}

.booking-card .card-title{
  font-size: 1.05rem;
  font-weight: 600;
  margin-bottom: 4px;
}

.booking-card .text-muted{
  font-size: 0.85rem;
}

.booking-card p{
  font-size: 0.85rem;
  margin-bottom: 6px;
}

.booking-card .text-success{
  font-size: 1.15rem;
  font-weight: 600;
}
</style>

<h2 class="mb-4">My Bookings</h2>

<div class="row">

<% if(bookings.length === 0){ %>
  <p>No bookings yet ðŸ˜”</p>
<% } %>

<% bookings.forEach(booking => { %>

  <div class="col-md-4 mb-4">

    <div class="card booking-card h-100 shadow-sm position-relative overflow-hidden">

      <!-- âœ… STATUS BADGE -->
      <% if(new Date(booking.checkOut) > new Date()){ %>
        <span class="status-badge">Upcoming</span>
      <% } else { %>
        <span class="status-badge bg-secondary">Completed</span>
      <% } %>

      <!-- âœ… CLICKABLE IMAGE -->
      <a href="/listings/<%= booking.property._id %>">
        <img 
          src="<%= booking.property.image.url %>" 
          class="card-img-top booking-img"
        >
      </a>

      <div class="card-body">

        <h5 class="card-title">
          <%= booking.property.title %>
        </h5>

        <p class="text-muted mb-1">
          <i class="fa-solid fa-location-dot"></i>
          <%= booking.property.location %>
        </p>

        <p class="mb-1">
          <b>Check-in:</b>
          <%= booking.checkIn.toDateString() %>
        </p>

        <p>
          <b>Check-out:</b>
          <%= booking.checkOut.toDateString() %>
        </p>

        <h5 class="text-success">â‚¹ <%= booking.totalPrice %></h5>

      </div>

      <div class="card-footer bg-white border-0 d-flex justify-content-between">

        <a href="/listings/<%= booking.property._id %>" 
           class="btn btn-dark btn-sm">
           View
        </a>

        <% if(new Date(booking.checkOut) > new Date()){ %>
        <form action="/bookings/<%= booking._id %>?_method=DELETE"
              method="POST">

          <button class="btn btn-outline-danger btn-sm">
            Cancel
          </button>

        </form>
        <% } %>

      </div>

    </div>

  </div>

<% }) %>

</div>